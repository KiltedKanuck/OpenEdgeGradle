 /*
 * This file was generated by the Gradle 'init' task.
 *
 * This is a general purpose Gradle build.
 * Learn how to create Gradle builds at https://guides.gradle.org/creating-new-gradle-builds
 */

import oe.espresso.latte.* 
 
plugins {
  id "oe.espresso.latte" version "0.2.6"
  id "base"
}

apply plugin: 'oe.espresso.latte'

abl { dlcHome = new File (System.getenv('DLC'))}

task compileTest(type: CompileAblTask) {

    destinationDir = file("${buildDir}/tests")
    source('src/test/abl')
    propath = files('src/test/abl')
    include('**/*.cls')
    include('**/*.p')

}

task compileCode(type: CompileAblTask) {

    destinationDir = file("${buildDir}/rcode")
    source('src/main/abl')
    propath = files('src/main/abl')
    include('**/*.cls')
    include('**/*.p')
    include('**/*.w')

}

task packageCode(type: CreateProcedureLibrary){

    dependsOn compileCode

    destFile = "${buildDir}/dist/${project.name}-${CLASSIFIER.toUpperCase()}-${VERSION}.pl"
    baseDir = "${buildDir}/rcode"
    includes= "**/*.r"
    excludes= "**/.pct"

}

task packageSRC(type: CreateProcedureLibrary){

    destFile = "${buildDir}/dist/${project.name}-SRC-${CLASSIFIER.toUpperCase()}-${VERSION}.pl"
    baseDir = "src/main/abl"

}
task ablTest(type: AblUnit) {

    dependsOn packageCode

  source("src/test/abl")
  include("**/*.cls")
  destinationDir = "${buildDir}/tests"
  writeLog = true
  baseDir = "${buildDir}"

  propath = files("src/test/abl" , "${buildDir}/dist/${project.name}-${CLASSIFIER.toUpperCase()}-${VERSION}.pl")

}

defaultTasks 'clean', 'packageSRC', 'packageCode', 'ablTest'

